{% extends "base.html" %}
{% load formatters %}

{% block title %}Secretarias e Orcamento | Sistema Tibau do Sul{% endblock %}

{% block content %}
<header class="page-intro">
  <h1>Secretarias e Orcamento</h1>
  <p>Distribuicao de recursos por orgao com foco na execucao financeira.</p>
</header>

{% if insights %}
<div class="insights-box">
  <h2>Insights automaticos</h2>
  <ul>
    {% for item in insights %}
    <li>{{ item }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<div class="export-bar">
  <a class="link-btn" href="/api/financas/por-secretaria/?export=csv&ano=2025&search={{ search }}">Exportar CSV</a>
</div>

<section class="panel">
  <div class="grid">
    <article class="kpi">
      <div class="label">Secretarias filtradas</div>
      <div class="v">{{ resumo.quantidade }}</div>
    </article>
    <article class="kpi">
      <div class="label">Orcamento total</div>
      <div class="v">{{ resumo.orcamento|currency_brl }}</div>
    </article>
    <article class="kpi">
      <div class="label">Empenhado</div>
      <div class="v">{{ resumo.empenhado|currency_brl }}</div>
    </article>
    <article class="kpi success">
      <div class="label">Pago</div>
      <div class="v">{{ resumo.pago|currency_brl }}</div>
    </article>
  </div>
</section>

<section class="panel">
  <form method="get" class="filter-grid">
    <div>
      <label for="secretarias-search" class="sr-only">Buscar secretaria</label>
      <input id="secretarias-search" type="text" name="search" placeholder="Buscar secretaria" value="{{ search }}">
    </div>
    <button type="submit">Filtrar</button>
  </form>
</section>

<section class="panel">
  <div class="table-wrap">
    <table>
      <thead><tr><th>Secretaria</th><th>Orcamento</th><th class="hide-mobile">Empenhado</th><th class="hide-mobile">Liquidado</th><th>Pago</th></tr></thead>
      <tbody>
        {% for item in despesas %}
        <tr>
          <td class="cell-text">{{ item.secretaria }}</td>
          <td class="num">{{ item.orcamento|currency_brl }}</td>
          <td class="num hide-mobile">{{ item.empenhado|currency_brl }}</td>
          <td class="num hide-mobile">{{ item.liquidado|currency_brl }}</td>
          <td class="num">{{ item.pago|currency_brl }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5">Nenhum dado encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
