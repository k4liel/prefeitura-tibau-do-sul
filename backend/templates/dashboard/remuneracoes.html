{% extends "base.html" %}
{% load formatters %}

{% block title %}Remuneracoes | Sistema Tibau do Sul{% endblock %}

{% block content %}
<header class="page-intro">
  <h1>Remuneracoes de Pessoas</h1>
  <p>Visao completa de remuneracao: prefeito, vice, secretarios, vereadores e demais servidores da folha.</p>
</header>

<section class="panel">
  <div class="grid">
    <article class="kpi">
      <div class="label">Alta gestao mapeada</div>
      <div class="v">{{ resumo.estrategicos }}</div>
    </article>
    <article class="kpi">
      <div class="label">Vereadores mapeados</div>
      <div class="v">{{ resumo.vereadores }}</div>
    </article>
    <article class="kpi accent">
      <div class="label">Servidores na folha</div>
      <div class="v">{{ resumo.servidores }}</div>
    </article>
    <article class="kpi success">
      <div class="label">Total bruto da folha</div>
      <div class="v">{{ resumo.total_bruto|currency_brl }}</div>
      <div class="meta">Total liquido: {{ resumo.total_liquido|currency_brl }}</div>
    </article>
  </div>
  <p class="subtle">
    Fonte principal: {{ resumo.fonte_principal }}. Sem salario identificado: {{ resumo.estrategicos_sem_salario }} (alta gestao) e {{ resumo.vereadores_sem_salario }} (legislativo).
  </p>
  {% if referencias_legais %}
  <p class="subtle">
    Base legal: Lei 804/2023 (vereador {{ referencias_legais.lei_804.vereador|currency_brl }}, presidente {{ referencias_legais.lei_804.vereador_presidente|currency_brl }}) e Lei 805/2023 (prefeito {{ referencias_legais.lei_805.prefeito|currency_brl }}, vice {{ referencias_legais.lei_805.vice_prefeito|currency_brl }}, secretario {{ referencias_legais.lei_805.secretario|currency_brl }}).
  </p>
  {% endif %}
</section>

<section class="panel">
  <h2>Prefeito, vice e secretarios</h2>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Cargo</th><th>Nome</th><th class="hide-mobile">Orgao</th><th>Bruto</th><th>Liquido</th><th class="hide-mobile">Fonte</th></tr></thead>
      <tbody>
        {% for item in rows_estrategicos %}
        <tr>
          <td data-label="Cargo"><span class="badge">{{ item.cargo }}</span></td>
          <td class="cell-text" data-label="Nome">{{ item.nome }}</td>
          <td class="cell-text hide-mobile" data-label="Orgao">{{ item.orgao }}</td>
          <td class="num" data-label="Bruto">{% if item.valor_bruto is not None %}{{ item.valor_bruto|currency_brl }}{% else %}-{% endif %}</td>
          <td class="num" data-label="Liquido">{% if item.valor_liquido is not None %}{{ item.valor_liquido|currency_brl }}{% else %}-{% endif %}</td>
          <td class="hide-mobile" data-label="Fonte">
            {% if item.fonte_salario == 'folha' or 'export' in item.fonte_salario %}
            <span class="badge success">folha</span>
            {% elif 'lei' in item.fonte_salario %}
            <span class="badge warning">lei</span>
            {% else %}
            <span class="badge">{{ item.fonte_salario }}</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Sem registros estrategicos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="panel">
  <h2>Vereadores</h2>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Nome</th><th class="hide-mobile">Orgao</th><th>Bruto</th><th>Liquido</th><th class="hide-mobile">Fonte</th></tr></thead>
      <tbody>
        {% for item in rows_vereadores %}
        <tr>
          <td class="cell-text" data-label="Nome">{{ item.nome }}</td>
          <td class="cell-text hide-mobile" data-label="Orgao">{{ item.orgao }}</td>
          <td class="num" data-label="Bruto">{% if item.valor_bruto is not None %}{{ item.valor_bruto|currency_brl }}{% else %}-{% endif %}</td>
          <td class="num" data-label="Liquido">{% if item.valor_liquido is not None %}{{ item.valor_liquido|currency_brl }}{% else %}-{% endif %}</td>
          <td class="hide-mobile" data-label="Fonte">
            {% if item.fonte_salario == 'folha' or 'export' in item.fonte_salario %}
            <span class="badge success">folha</span>
            {% elif 'lei' in item.fonte_salario %}
            <span class="badge warning">lei</span>
            {% else %}
            <span class="badge">{{ item.fonte_salario }}</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="5">Sem vereadores cadastrados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="panel">
  <div class="split">
    <h2>Todos os servidores</h2>
    <span class="badge">{{ page_obj.paginator.count }} registros</span>
  </div>
  <form method="get" class="filter-grid" style="margin-bottom: 14px;">
    <div>
      <label for="rem-search" class="sr-only">Buscar servidor</label>
      <input id="rem-search" type="text" name="search" placeholder="Buscar por nome ou orgao" value="{{ search }}">
    </div>
    <button type="submit">Filtrar</button>
  </form>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Nome</th><th class="hide-mobile">Orgao</th><th class="hide-mobile">Vinculo</th><th>Bruto</th><th>Liquido</th></tr></thead>
      <tbody>
        {% for item in page_obj %}
        <tr>
          <td class="cell-text" data-label="Nome">{{ item.nome }}</td>
          <td class="cell-text hide-mobile" data-label="Orgao">{{ item.orgao }}</td>
          <td class="hide-mobile" data-label="Vinculo">{{ item.vinculo }}</td>
          <td class="num" data-label="Bruto">{{ item.valor_bruto|currency_brl }}</td>
          <td class="num" data-label="Liquido">{{ item.valor_liquido|currency_brl }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5">Nenhum servidor encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if page_obj.has_other_pages %}
  <nav class="pagination" aria-label="Paginacao">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&search={{ search }}">Anterior</a>
    {% endif %}
    <span class="info">Pagina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&search={{ search }}">Proxima</a>
    {% endif %}
  </nav>
  {% endif %}
</section>
{% endblock %}
